@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<h2>Upload something here</h2>

<input id="file" type="file" />

@section Scripts
{
    <script async src="~/lib/tus-js-client/dist/tus.min.js"></script>
    <script type="text/javascript">
        let input = document.getElementById("file");

        input.addEventListener("change", function (e) {
            // Get the selected file from the input element
            var file = e.target.files[0]

            // Create a new tus upload
            var upload = new tus.Upload(file, {
                endpoint: "/files",
                retryDelays: [0, 3000, 5000, 10000, 20000],
                metadata: {
                    fileName: file.name,
                    convertTo: "pdf"
                },
                onError: function (error) {
                    console.log("Failed because: " + error)
                },
                onProgress: function (bytesUploaded, bytesTotal) {
                    var percentage = (bytesUploaded / bytesTotal * 100).toFixed(2)
                    console.log(bytesUploaded, bytesTotal, percentage + "%")
                },
                onSuccess: function () {
                    console.log("Download %s from %s", upload.file.name, upload.url)
                }
            })

            // Start the upload
            upload.start()
        })
    </script>
}